(function(k,A){typeof exports=="object"&&typeof module<"u"?module.exports=A():typeof define=="function"&&define.amd?define(A):(k=typeof globalThis<"u"?globalThis:k||self,k.Shotstack=A())})(this,function(){"use strict";var Ze=Object.defineProperty;var et=(k,A,R)=>A in k?Ze(k,A,{enumerable:!0,configurable:!0,writable:!0,value:R}):k[A]=R;var Q=(k,A,R)=>(et(k,typeof A!="symbol"?A+"":A,R),R);function k(){}function A(e){return e()}function R(){return Object.create(null)}function j(e){e.forEach(A)}function he(e){return typeof e=="function"}function _e(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let q;function me(e,t){return q||(q=document.createElement("a")),q.href=t,e===q.href}function ge(e){return Object.keys(e).length===0}let L=!1;function ye(){L=!0}function ve(){L=!1}function be(e,t,n,r){for(;e<t;){const l=e+(t-e>>1);n(l)<=r?e=l+1:t=l}return e}function Ee(e){if(e.hydrate_init)return;e.hydrate_init=!0;let t=e.childNodes;if(e.nodeName==="HEAD"){const s=[];for(let c=0;c<t.length;c++){const u=t[c];u.claim_order!==void 0&&s.push(u)}t=s}const n=new Int32Array(t.length+1),r=new Int32Array(t.length);n[0]=-1;let l=0;for(let s=0;s<t.length;s++){const c=t[s].claim_order,u=(l>0&&t[n[l]].claim_order<=c?l+1:be(1,l,m=>t[n[m]].claim_order,c))-1;r[s]=n[u]+1;const h=u+1;n[h]=s,l=Math.max(h,l)}const o=[],i=[];let a=t.length-1;for(let s=n[l]+1;s!=0;s=r[s-1]){for(o.push(t[s-1]);a>=s;a--)i.push(t[a]);a--}for(;a>=0;a--)i.push(t[a]);o.reverse(),i.sort((s,c)=>s.claim_order-c.claim_order);for(let s=0,c=0;s<i.length;s++){for(;c<o.length&&i[s].claim_order>=o[c].claim_order;)c++;const u=c<o.length?o[c]:null;e.insertBefore(i[s],u)}}function p(e,t){if(L){for(Ee(e),(e.actual_end_child===void 0||e.actual_end_child!==null&&e.actual_end_child.parentNode!==e)&&(e.actual_end_child=e.firstChild);e.actual_end_child!==null&&e.actual_end_child.claim_order===void 0;)e.actual_end_child=e.actual_end_child.nextSibling;t!==e.actual_end_child?(t.claim_order!==void 0||t.parentNode!==e)&&e.insertBefore(t,e.actual_end_child):e.actual_end_child=t.nextSibling}else(t.parentNode!==e||t.nextSibling!==null)&&e.appendChild(t)}function C(e,t,n){L&&!n?p(e,t):(t.parentNode!==e||t.nextSibling!=n)&&e.insertBefore(t,n||null)}function _(e){e.parentNode.removeChild(e)}function we(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function b(e){return document.createElement(e)}function I(e){return document.createTextNode(e)}function $(){return I(" ")}function U(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function d(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function N(e){return Array.from(e.childNodes)}function Ne(e){e.claim_info===void 0&&(e.claim_info={last_index:0,total_claimed:0})}function Z(e,t,n,r,l=!1){Ne(e);const o=(()=>{for(let i=e.claim_info.last_index;i<e.length;i++){const a=e[i];if(t(a)){const s=n(a);return s===void 0?e.splice(i,1):e[i]=s,l||(e.claim_info.last_index=i),a}}for(let i=e.claim_info.last_index-1;i>=0;i--){const a=e[i];if(t(a)){const s=n(a);return s===void 0?e.splice(i,1):e[i]=s,l?s===void 0&&e.claim_info.last_index--:e.claim_info.last_index=i,a}}return r()})();return o.claim_order=e.claim_info.total_claimed,e.claim_info.total_claimed+=1,o}function Te(e,t,n,r){return Z(e,l=>l.nodeName===t,l=>{const o=[];for(let i=0;i<l.attributes.length;i++){const a=l.attributes[i];n[a.name]||o.push(a.name)}o.forEach(i=>l.removeAttribute(i))},()=>r(t))}function w(e,t,n){return Te(e,t,n,b)}function D(e,t){return Z(e,n=>n.nodeType===3,n=>{const r=""+t;if(n.data.startsWith(r)){if(n.data.length!==r.length)return n.splitText(r.length)}else n.data=r},()=>I(t),!0)}function x(e){return D(e," ")}function V(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}let Y;function J(e){Y=e}const F=[],ee=[],B=[],te=[],Se=Promise.resolve();let z=!1;function ke(){z||(z=!0,Se.then(ne))}function W(e){B.push(e)}const X=new Set;let G=0;function ne(){const e=Y;do{for(;G<F.length;){const t=F[G];G++,J(t),Ae(t.$$)}for(J(null),F.length=0,G=0;ee.length;)ee.pop()();for(let t=0;t<B.length;t+=1){const n=B[t];X.has(n)||(X.add(n),n())}B.length=0}while(F.length);for(;te.length;)te.pop()();z=!1,X.clear(),J(e)}function Ae(e){if(e.fragment!==null){e.update(),j(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(W)}}const Oe=new Set;function Me(e,t){e&&e.i&&(Oe.delete(e),e.i(t))}function $e(e,t,n,r){const{fragment:l,on_mount:o,on_destroy:i,after_update:a}=e.$$;l&&l.m(t,n),r||W(()=>{const s=o.map(A).filter(he);i?i.push(...s):j(s),e.$$.on_mount=[]}),a.forEach(W)}function xe(e,t){const n=e.$$;n.fragment!==null&&(j(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Ie(e,t){e.$$.dirty[0]===-1&&(F.push(e),ke(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Pe(e,t,n,r,l,o,i,a=[-1]){const s=Y;J(e);const c=e.$$={fragment:null,ctx:null,props:o,update:k,not_equal:l,bound:R(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(s?s.$$.context:[])),callbacks:R(),dirty:a,skip_bound:!1,root:t.target||s.$$.root};i&&i(c.root);let u=!1;if(c.ctx=n?n(e,t.props||{},(h,m,...y)=>{const g=y.length?y[0]:m;return c.ctx&&l(c.ctx[h],c.ctx[h]=g)&&(!c.skip_bound&&c.bound[h]&&c.bound[h](g),u&&Ie(e,h)),m}):[],c.update(),u=!0,j(c.before_update),c.fragment=r?r(c.ctx):!1,t.target){if(t.hydrate){ye();const h=N(t.target);c.fragment&&c.fragment.l(h),h.forEach(_)}else c.fragment&&c.fragment.c();t.intro&&Me(e.$$.fragment),$e(e,t.target,t.anchor,t.customElement),ve(),ne()}J(s)}class Re{$destroy(){xe(this,1),this.$destroy=k}$on(t,n){const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const l=r.indexOf(n);l!==-1&&r.splice(l,1)}}$set(t){this.$$set&&!ge(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const tt="",De="A 'merge' property is required",Ce="Property 'merge' must be an array",Je="Property 'merge' must contain at least one element",Fe="A 'find' property is required on every element inside 'merge'",je="Every 'find' property inside 'merge' must be of type string",qe="Every 'find' property inside 'merge' must be a string of length equal to or higher than one",Le="A 'replace' property is required on every element inside 'merge'";class P extends Error{constructor(t){super(t)}}function K(e,t){return!(e in t)}function Ve(e,t){return!(t[e]instanceof Array)}function Be(e,t){return typeof t[e]!="string"}function Ge(e,t){return!(typeof t[e]=="string"&&t[e].length>0)}function He(e,t){return!(t[e]instanceof Array&&t[e].length>0)}function Ue(e){try{const t=JSON.parse(e);if(K("merge",t))throw new P(De);if(Ve("merge",t))throw new P(Ce);if(He("merge",t))throw new P(Je);const n=Ye(t.merge);return{...t,merge:n}}catch(t){throw t instanceof P||t.message?t:new P("There was a problem parsing the template json")}}function Ye(e){return e.map(n=>{if(K("find",n))throw new P(Fe);if(K("replace",n))throw new P(Le);if(Be("find",n))throw new P(je);if(Ge("find",n))throw new P(qe);return n}).map(({find:n,replace:r})=>({find:n,replace:typeof r=="string"?r:JSON.stringify(r)}))}class ze{constructor(t={merge:[]}){Q(this,"template");Q(this,"result");this.template=t,this.result=t}setTemplateSource(t){try{const n=Ue(t);return this.template=n,this.result=n,n}catch(n){throw n instanceof Error?n:new Error("Error parsing JSON")}}updateResultMergeFields(t){const{find:n,replace:r}=t,l={find:n,replace:r},o=this.result.merge.map(i=>(i==null?void 0:i.find)===t.find?l:i);return this.result={...this.result,merge:o},o}}const We={merge:[{find:"NAME",replace:"world"}],timeline:{tracks:[{clips:[{asset:{type:"title",text:"Hello {{ NAME }}",style:"future"},start:0,length:5}]}]},output:{format:"mp4",resolution:"hd"}},it="";function re(e,t,n){const r=e.slice();return r[9]=t[n].find,r[10]=t[n].replace,r}function le(e){let t,n,r;return{c(){t=b("p"),n=b("span"),r=I(e[2]),this.h()},l(l){t=w(l,"P",{"data-cy":!0,class:!0});var o=N(t);n=w(o,"SPAN",{class:!0});var i=N(n);r=D(i,e[2]),i.forEach(_),o.forEach(_),this.h()},h(){d(n,"class","monospace text-orange-900 svelte-u6rap9"),d(t,"data-cy","template-input-error"),d(t,"class","bg-rose-200 rounded py-2 px-4 svelte-u6rap9")},m(l,o){C(l,t,o),p(t,n),p(n,r)},p(l,o){o&4&&V(r,l[2])},d(l){l&&_(t)}}}function ie(e){let t,n,r,l,o,i=e[0].merge,a=[];for(let s=0;s<i.length;s+=1)a[s]=se(re(e,i,s));return{c(){t=b("div"),n=b("h1"),r=I("Modify Merge Values"),l=$(),o=b("div");for(let s=0;s<a.length;s+=1)a[s].c();this.h()},l(s){t=w(s,"DIV",{"data-cy":!0,class:!0});var c=N(t);n=w(c,"H1",{class:!0});var u=N(n);r=D(u,"Modify Merge Values"),u.forEach(_),l=x(c),o=w(c,"DIV",{class:!0});var h=N(o);for(let m=0;m<a.length;m+=1)a[m].l(h);h.forEach(_),c.forEach(_),this.h()},h(){d(n,"class","text-teal-400 px-1 svelte-u6rap9"),d(o,"class","border p-4 mb-6 svelte-u6rap9"),d(t,"data-cy","merge-fields-input-section"),d(t,"class","svelte-u6rap9")},m(s,c){C(s,t,c),p(t,n),p(n,r),p(t,l),p(t,o);for(let u=0;u<a.length;u+=1)a[u].m(o,null)},p(s,c){if(c&33){i=s[0].merge;let u;for(u=0;u<i.length;u+=1){const h=re(s,i,u);a[u]?a[u].p(h,c):(a[u]=se(h),a[u].c(),a[u].m(o,null))}for(;u<a.length;u+=1)a[u].d(1);a.length=i.length}},d(s){s&&_(t),we(a,s)}}}function se(e){let t,n,r="{{ "+e[9]+" }} ",l,o,i,a,s,c,u,h,m;function y(...g){return e[7](e[9],...g)}return{c(){t=b("div"),n=b("label"),l=I(r),i=$(),a=b("input"),u=$(),this.h()},l(g){t=w(g,"DIV",{"data-cy":!0,class:!0});var f=N(t);n=w(f,"LABEL",{for:!0,class:!0});var v=N(n);l=D(v,r),v.forEach(_),i=x(f),a=w(f,"INPUT",{class:!0,id:!0,type:!0}),u=x(f),f.forEach(_),this.h()},h(){d(n,"for",o=e[9]),d(n,"class","block mb-2 monospace svelte-u6rap9"),d(a,"class","border w-full mb-3 pl-2 py-1 text-stone-500 svelte-u6rap9"),d(a,"id",s=e[9]),d(a,"type","text"),a.value=c=ce(e[10]),d(t,"data-cy","label-input"),d(t,"class","svelte-u6rap9")},m(g,f){C(g,t,f),p(t,n),p(n,l),p(t,i),p(t,a),p(t,u),h||(m=U(a,"input",y),h=!0)},p(g,f){e=g,f&1&&r!==(r="{{ "+e[9]+" }} ")&&V(l,r),f&1&&o!==(o=e[9])&&d(n,"for",o),f&1&&s!==(s=e[9])&&d(a,"id",s),f&1&&c!==(c=ce(e[10]))&&a.value!==c&&(a.value=c)},d(g){g&&_(t),h=!1,m()}}}function ae(e){let t,n,r;return{c(){t=b("p"),n=b("span"),r=I(e[3]),this.h()},l(l){t=w(l,"P",{"data-cy":!0,class:!0});var o=N(t);n=w(o,"SPAN",{class:!0});var i=N(n);r=D(i,e[3]),i.forEach(_),o.forEach(_),this.h()},h(){d(n,"class","monospace text-orange-900 svelte-u6rap9"),d(t,"data-cy","merge-fields-input-error"),d(t,"class","bg-rose-200 rounded py-2 px-4 svelte-u6rap9")},m(l,o){C(l,t,o),p(t,n),p(n,r)},p(l,o){o&8&&V(r,l[3])},d(l){l&&_(t)}}}function oe(e){let t,n,r,l,o,i,a,s,c,u=JSON.stringify(e[1],null,2)+"",h,m,y;return{c(){t=b("div"),n=b("h1"),r=I("Result"),l=$(),o=b("abbr"),i=b("img"),s=$(),c=b("p"),h=I(u),this.h()},l(g){t=w(g,"DIV",{"data-cy":!0,class:!0});var f=N(t);n=w(f,"H1",{class:!0});var v=N(n);r=D(v,"Result"),v.forEach(_),l=x(f),o=w(f,"ABBR",{title:!0,class:!0});var T=N(o);i=w(T,"IMG",{src:!0,alt:!0,class:!0}),T.forEach(_),s=x(f),c=w(f,"P",{"data-cy":!0,class:!0});var S=N(c);h=D(S,u),S.forEach(_),f.forEach(_),this.h()},h(){d(n,"class","text-teal-400 px-1 inline-block mr-2 svelte-u6rap9"),me(i.src,a="img/copy-regular.svg")||d(i,"src",a),d(i,"alt","copy-button"),d(i,"class","h-4 cursor-pointer inline mb-1 svelte-u6rap9"),d(o,"title","Copy to clipboard"),d(o,"class","svelte-u6rap9"),d(c,"data-cy","result"),d(c,"class","h-60 overflow-auto border p-4 whitespace-pre monospace svelte-u6rap9"),d(t,"data-cy","result-section"),d(t,"class","svelte-u6rap9")},m(g,f){C(g,t,f),p(t,n),p(n,r),p(t,l),p(t,o),p(o,i),p(t,s),p(t,c),p(c,h),m||(y=U(i,"click",e[6]),m=!0)},p(g,f){f&2&&u!==(u=JSON.stringify(g[1],null,2)+"")&&V(h,u)},d(g){g&&_(t),m=!1,y()}}}function Xe(e){var de;let t,n,r,l,o,i,a,s,c,u,h,m,y,g,f=e[2]&&le(e),v=((de=e[0].merge)==null?void 0:de.length)&&!e[2]&&ie(e),T=e[3]&&ae(e),S=!e[3]&&!e[2]&&oe(e);return{c(){t=b("section"),n=b("form"),r=b("div"),l=b("label"),o=I("Paste template"),i=$(),a=b("textarea"),c=$(),f&&f.c(),u=$(),v&&v.c(),h=$(),T&&T.c(),m=$(),S&&S.c(),this.h()},l(E){t=w(E,"SECTION",{"data-cy":!0,class:!0});var O=N(t);n=w(O,"FORM",{class:!0});var M=N(n);r=w(M,"DIV",{"data-cy":!0,class:!0});var H=N(r);l=w(H,"LABEL",{for:!0,class:!0});var pe=N(l);o=D(pe,"Paste template"),pe.forEach(_),i=x(H),a=w(H,"TEXTAREA",{"data-cy":!0,class:!0,id:!0}),N(a).forEach(_),H.forEach(_),c=x(M),f&&f.l(M),u=x(M),v&&v.l(M),h=x(M),T&&T.l(M),M.forEach(_),m=x(O),S&&S.l(O),O.forEach(_),this.h()},h(){d(l,"for","json-input"),d(l,"class","text-teal-400 px-1 svelte-u6rap9"),d(a,"data-cy","template-input"),d(a,"class","w-full h-60 monospace border p-4 overflow-auto whitespace-pre resize-none svelte-u6rap9"),d(a,"id","json-input"),a.value=s=JSON.stringify(e[0],null,2),d(r,"data-cy","template-input-section"),d(r,"class","mb-6 svelte-u6rap9"),d(n,"class","svelte-u6rap9"),d(t,"data-cy","form-container"),d(t,"class","max-w-lg my-4 mx-auto border rounded-xl px-7 py-4 svelte-u6rap9")},m(E,O){C(E,t,O),p(t,n),p(n,r),p(r,l),p(l,o),p(r,i),p(r,a),p(n,c),f&&f.m(n,null),p(n,u),v&&v.m(n,null),p(n,h),T&&T.m(n,null),p(t,m),S&&S.m(t,null),y||(g=U(a,"input",e[4]),y=!0)},p(E,[O]){var M;O&1&&s!==(s=JSON.stringify(E[0],null,2))&&(a.value=s),E[2]?f?f.p(E,O):(f=le(E),f.c(),f.m(n,u)):f&&(f.d(1),f=null),((M=E[0].merge)==null?void 0:M.length)&&!E[2]?v?v.p(E,O):(v=ie(E),v.c(),v.m(n,h)):v&&(v.d(1),v=null),E[3]?T?T.p(E,O):(T=ae(E),T.c(),T.m(n,null)):T&&(T.d(1),T=null),!E[3]&&!E[2]?S?S.p(E,O):(S=oe(E),S.c(),S.m(t,null)):S&&(S.d(1),S=null)},i:k,o:k,d(E){E&&_(t),f&&f.d(),v&&v.d(),T&&T.d(),S&&S.d(),y=!1,g()}}}function ce(e){if(typeof e=="string")return e;try{return JSON.stringify(e)}catch{return e}}function Ke(e,t,n){const r=new ze(We);let l=r.template,o=r.result,i,a;function s(m){try{const y=r.setTemplateSource(m.target.value);n(0,l=y),n(1,o=y),n(2,i="")}catch(y){n(2,i=y.message)}}function c(m){try{const y=r.updateResultMergeFields(m);n(1,o={...o,merge:y}),n(3,a="")}catch(y){n(3,a=y.message)}}function u(){navigator.clipboard.writeText(JSON.stringify(o)),alert("JSON copied to clipboard!")}return[l,o,i,a,s,c,u,(m,y)=>c({find:m,replace:y.currentTarget.value})]}class Qe extends Re{constructor(t){super(),Pe(this,t,Ke,Xe,_e,{})}}const ue={render:e=>new Qe({target:e})},fe=document.querySelector("#shotstack-form-field");return fe&&ue.render(fe),ue});
